---
title: "A factor tutorial in R"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = "figures/",
                      echo = TRUE, warning = FALSE, message = FALSE)
```

---

# Packages

```{r}
library(forcats)
library(dplyr)
library(readr)
```

---

# Making Factors

Factors are a categorical vectors of variables with an order mapped onto them. By default `R` will apply alphabetical ordering to a factor.

We can create factors using the `factor()` function:

```{r factor}
treatments <- factor(c("lpg", "three_stone", "gasifier",
                       "fan_rocket", "rocket_elbow", "control"))
treatments
```

We can check use `parse_factor()` to see if the levels we are creating match a vector of factors. This is useful when checking for anomolies in a dataset for example:

```{r parse, warning = TRUE}
x <- c("control", "lpg", "lpg", "gasifier", "control",
       "fan_rocket", "rocket elbow", "rocket_elbow")

levels <- c("lpg", "three_stone", "gasifier",
            "fan_rocket", "rocket_elbow", "control")

parse_factor(x, levels)
```

Note how the variable in the vector `x` is coerced to `<NA>` and a warning message is given. Note also, there is a level slot for `three_stone_fire` in the new object, even though it doen't appear in the data vector `x`.

---

# Summarizing Factors

We'll often encounter a column of class `factor` in a dataframe e.g.: 

```{r}
stoves <- data_frame(type = factor(sample(levels, 500, replace = TRUE)))

head(stoves, 4)
```

We can use the `levels()` functions to return a character vector containing the distinct levels the a factor contains. We can then interrogate the vector returned by `levels()`:

```{r}
levels(stoves$type)

class(levels(stoves$type))

length(levels(stoves$type))
```

We can use `group_by()` and `count()` to produce a summary of the factor column:

```{r}
stoves %>% 
group_by(type) %>%
count()
```

---

# Ordering Factors

Factors may not be a useful order. There are a number of ways to a factor:

## by variable

```{r}
 stove_exposure <- stoves %>%
                   left_join(data_frame(type = factor(levels),
                                        pm25 = c(10, 500, 35, 100, 250, 0)),
                             by = "type")
```

We can use `fct_reorder()` to reorder the levels in a factor by a different variable. For example, let's reorder `type` by the $PM_{2.5}$ exposure level:

```{r}
stove_exposure <- stove_exposure %>%
                  mutate(type =  fct_reorder(type, pm25))

levels(stove_exposure$type)
```

## by frequency

We can use `fct_infreq()` to reorder the levels in a factor by the frequency that they occur. For example, let's reorder `type`:

```{r}
stove_exposure <- stove_exposure %>%
                  mutate(type =  fct_infreq(type))

levels(stove_exposure$type)
```

---

# Manipulating Levels

## move

```{r}
#fct_rev()
#fct_relevel()
```

## change

```{r}
#fct_recode()
```

## combine

```{r}
#fct_recode()
#fct_collapse()
#fct_lump()
```

---

# Ploting Factors

```{r}

```

---

